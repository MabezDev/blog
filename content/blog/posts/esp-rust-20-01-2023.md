+++
title="Rust on Espressif chips - 20-01-2023"
date=2023-01-20
draft=false
[taxonomies]
tags=["rust", "espressif", "esp32", "llvm"]
+++

This is the next quarterly update of esp-rs effort, detailing the progress over Q4 2022.

## Rust Compiler & LLVM

Other than the occasional rebase for every Rust release, there is not too much to report on the rust compiler fork. However, we have really exciting news about LLVM. The first 10 patches Xtensa patches have been approved and _committed_ upstream :tada:, you can view them [here](https://github.com/search?q=repo%3Allvm%2Fllvm-project+Xtensa&type=commits). This is exciting for us, Espressif has been pushing this upstreaming effort since 2019! So it's very nice to have something upstream, with plenty more patches to follow. At this point, I'd also like to make it clear that you do **not** need the forked compiler for our RISC-V-based chips, esp32c2, esp32c3, esp32c6 etc. You only need the forked compiler for our Xtensa-based chips, esp32, esp32s2 & esp32s3.

// TODO mention lld now shipping but not yet recommended

[espup](https://github.com/esp-rs/espup), our custom toolchain manager has seen some nice improvements over the quarter. It now leverages `async` to improve installation times, by downloading multiple things concurrently. We switched to espup in our CI pipelines and saw a significant improvement in setup time.

## esp-hal - no_std


## esp-wifi - no_std

[esp-wifi](https://github.com/esp-rs/esp-wifi) saw some nice features over the last quarter, along with some bug fixes, performance improvements and refactors.

- WiFi support for ESP32-C2 - [#07](https://github.com/esp-rs/esp-wifi/pull/107)
- basic WiFi power safe support - [#103](https://github.com/esp-rs/esp-wifi/pull/103)
- Bluetooth LE support for ESP32-S3 - [#105](https://github.com/esp-rs/esp-wifi/pull/105)

## esp-idf - std



## Tooling

### espflash

### Wokwi


## The 2023 roadmap

We've been planning what we'd like to achieve in the next year, and have started putting together a basic roadmap.

### Async

Over the last year we've made a real effort to get blocking implementations available for most peripherals both in our Standard library effort, and no_std efforts. Blocking is generally simpler to implement, as async relies on a good story for interrupts & DMA (direct memory access). This year we'd like to push for more async across both approaches; this includes async peripheral drivers (SPI, UART, I2C etc), including but not limited to the `embedded-hal-async` traits, as well as async networking solutions. Those of you familiar with the Standard library approach may have noticed there is actually quite a good async networking solution already available, so our main focus for async networking will be on the no_std `esp-wifi` crate.

### Chip support

For both approaches, we will be adding support for the newly release ESP32-C6, as well as preparing support the ESP32-H2 and ESP32-P4 once they are officially released. Support for the ESP32-C6 is in progress for no_std, and for STD, ESP32C6 support will be added with the release of esp-idf v5.1 (expected in May).

### Low Power modes and co-processor support

Starting from the ESP32-S2, our chips have included a low power RISC-V coprocessor for handling low power operations when the main CPU is not needed. We'd like to leverage `esp-hal` for creating applications that can run on the constrained low power core, for both no_std _and_ std applications. The low power core is too resource constrained to run the full standard library, so using `esp-hal` makes perfect sense here.

### STD build times

One of the barriers when developing for the STD platform is build times. We know of a number of improvements we can make to reduce the build time. One thing we'd like to take a look at this year is slimming down the esp-idf build, currently we build everything, but esp-idf is made of components, which can be disabled if they're not needed. We're also aware that a lot of the 'build' time is actually spent downloading esp-idf sources via git, it would be great if we could cut this time down somehow.

### Documentation

We've made a lot of progress over the last year, but moving so fast has left the documentation situation in a not so great state. We're rewriting [the book](TODO add link here) this year to cut out irrelevant, outdated information as well as filling in the gaps created in the last year. We're currently sefl-hosting our standard library documentation because we need an internet connection to download toolchains/sources not present on the docs.rs runners, if possible we'd like to find a way to host our docs on docs.rs.


<br/>

---

<br/>

