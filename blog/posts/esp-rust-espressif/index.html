<!DOCTYPE html>
<html lang="en-us">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <meta itemprop="name" content="Scott Mabin" />
  <meta itemprop="description" content="Scott Mabin&#x27;s blog" />

  <link rel="apple-touch-icon" sizes="180x180" href="https://mabez.dev/apple-touch-icon.png"/>
  <link rel="icon" type="image/png" sizes="32x32" href="https://mabez.dev/favicon-32x32.png" />
  <link
    rel="icon"
    type="image/png"
    sizes="16x16"
    href="https://mabez.dev/favicon-16x16.png"
  />
  <link
    rel="shortcut icon"
    href="https://mabez.dev/favicon.ico"
  />
  <link rel="stylesheet" href="https://mabez.dev/style.css"/>
  
  <title>Rust on Espressif chips</title>
  

  
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://mabez.dev/rss.xml">
  

  <body id="page">

	
<header id="site-header" class="animated slideInUp faster">
  <div class="hdr-wrapper section-inner">
    <div class="hdr-left">
      <div class="site-branding">
        <a href="https:&#x2F;&#x2F;mabez.dev">Scott Mabin</a>
      </div>
      <nav class="site-nav hide-in-mobile">
            
        
        <a href="https://mabez.dev/blog/posts">Blog</a>
        
      </nav>
    </div>
    <div class="hdr-right hdr-icons">
      <span class="hdr-social hide-in-mobile">
        

<a href="https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;scott-mabin" target="_blank" rel="noopener me"
   title="linkedin">
  
  <svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
  
</a>

<a href="https:&#x2F;&#x2F;github.com&#x2F;mabezdev" target="_blank" rel="noopener me"
   title="github">
  
  <svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>
  
</a>


      </span>
      <button id="menu-btn" class="hdr-btn" title="Menu">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="feather feather-menu"
        >
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
    </div>
  </div>
</header>
<div id="mobile-menu" class="animated fast">
  <ul>
    
    <li><a href="https://mabez.dev/blog/posts">Blog</a></li>
    
  </ul>
</div>

	
	

		
<main class="site-main section-inner animated fadeIn faster">
  <article class="thin">
	<header class="post-header">
	  <div class="post-meta">
		
		<span>Jul 28, 2021</span>
		<small> - 
<span class="reading-time" title="Estimated read time">
  
  3 min read
  
</span>
</small>
		
            
	  </div>
	  <h1>Rust on Espressif chips</h1>
	</header>

	<div class="content">
        
	  <p>It's been a while since my last post. I have some exciting news to share before going over the progress over the last nine months. I will be joining Espressif full time to work on Rust support for all of Espressif's chips, past, present and future! I am very excited to join Espressif and improve the Rust ecosystem surrounding their chips!</p>
<h3 id="organisation">Organisation</h3>
<p>The forked compiler with esp support has been moved into the <code>esp-rs</code> organisation, along with some idf support crates - more on that shortly! <a href="https://github.com/esp-rs/rust/discussions">Discussions</a> have been enabled on the <code>esp-rs/rust</code> repository, and for the last month Espressif have been hosting weekly community meetings focusing on pushing Rust support forward. If you'd like to discuss something and attend, drop a comment in the latest thread and request an invite!</p>
<h3 id="the-rust-standard-library-on-espressif-chips">The Rust standard library on Espressif chips</h3>
<p><a href="https://github.com/ivmarkov">@ivmarkov</a> been working very hard on porting the Rust STD library to <code>esp-idf</code>, the C based development environment for Espressif chips. <code>esp-idf</code> has a newlib environment which can be used to build the Rust library on top of. <a href="https://github.com/ivmarkov">@ivmarkov</a> has put together <a href="https://github.com/ivmarkov/rust-esp32-std-hello">rust-esp32-std-hello</a> demo repo to show off the capabilities, which include WiFi, threads and driving a display using the <code>esp-idf</code>'s drivers. Extremely cool stuff! There are a few teething issues, which you can track <a href="https://github.com/esp-rs/rust/issues/57">here</a> but hopefully we will be in a position to start upstreaming these patches soon.</p>
<p>To suppliment the standard library for Espressif chips, <a href="https://github.com/esp-rs/esp-idf-hal"><code>esp-idf-hal</code></a> has been updated and moved into the <code>esp-rs</code> organisation. This crate has API's to use peripherals and hardware that do not have abstractions in the standard library, for example the SPI peripheral. Along with the HAL, <a href="https://github.com/esp-rs/esp-idf-svc"><code>esp-idf-svc</code></a> has also been added, which is an implementation of <a href="https://github.com/esp-rs/embedded-svc"><code>embedded-svc</code></a> traits for Espressif chips. The goal behind <code>embedded-svc</code> is to provide abstractions around higher level embedded services, WiFi, Ping, HTTPD, NVS etc.</p>
<h3 id="bare-metal">Bare metal</h3>
<p>Whilst the biggest changes have been around esp standard library developments, bare metal support has not been forgotten! A few months I got my hands on a <code>esp32c3</code>, a <code>RISC-V</code> based chip; because upstream Rust already supports <code>RISC-V</code> putting together a rudimentary bare metal example was <a href="https://github.com/MabezDev/esp32c3-experiments">quite simple</a>!</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Blinky program written in <a href="https://twitter.com/hashtag/rustlang?src=hash&amp;ref_src=twsrc%5Etfw">#rustlang</a>, running on the RISC-V powered <a href="https://twitter.com/hashtag/esp32c3?src=hash&amp;ref_src=twsrc%5Etfw">#esp32c3</a> from <a href="https://twitter.com/hashtag/espressif?src=hash&amp;ref_src=twsrc%5Etfw">#espressif</a> . <a href="https://t.co/9qfqZk1WYq">pic.twitter.com/9qfqZk1WYq</a></p>&mdash; Scott Mabin (@mabezzzzz) <a href="https://twitter.com/mabezzzzz/status/1391500605915607049?ref_src=twsrc%5Etfw">May 9, 2021</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>Whilst the program above worked, much like <a href="https://mabez.dev/blog/posts/esp32-rust/">my first ever post</a> it isn't very &quot;Rusty&quot;. Fortunately Espressif have recently release <a href="https://github.com/espressif/svd/tree/esp32c3">a preliminary SVD file for the esp32c3</a>, the first of its kind from Espressif which is super exciting! This means we can feed the SVD into <code>svd2rust</code> (see my other post about doing this for the esp32 <a href="https://mabez.dev/blog/posts/esp32-rust-svd-pac/">here</a>) and generate a peripheral access crate (PAC) for the esp32c3 and build abstractions on top of that. With official SVD's coming out I hope that we can integrate that into the current bare metal <a href="https://github.com/esp-rs/esp32-hal"><code>esp32-hal</code></a>, turning it into a mono repository supporting all of Espressif's chips in pure Rust.</p>
<p>It also means I can finally kill off the abomination which is <a href="https://github.com/MabezDev/idf2svd"><code>idf2svd</code></a> :D.</p>
<h3 id="what-s-next">What's next?</h3>
<p>We should be able to start upstreaming some of the RISC-V based changes soon! With official SVD's coming out, bare metal esp32 support should start moving forward again too.</p>

	</div>
	<hr class="post-end">
	<footer class="post-info">
    
	  <p>
		<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>
		
		
		<span class="tag"><a href="https://mabez.dev/tags/rust/">rust</a></span>
		
		<span class="tag"><a href="https://mabez.dev/tags/espressif/">espressif</a></span>
		
		<span class="tag"><a href="https://mabez.dev/tags/personal/">personal</a></span>
		
		
    </p>
    
    <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>709 Words</p>
    
    <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2021-07-28</p>
    
	</footer>
  </article>
    
  
  <div class="post-nav thin">
	
	<a class="next-post" href="https:&#x2F;&#x2F;mabez.dev&#x2F;blog&#x2F;posts&#x2F;esp-rust-18-10-2021&#x2F;">
	  <span class="post-nav-label">
		<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left">
		  <line x1="19" y1="12" x2="5" y2="12"></line>
		  <polyline points="12 19 5 12 12 5"></polyline>
		</svg>&nbsp;Newer</span><br>
		<span>Rust on Espressif chips - 18-10-2021</span>
	</a>
	
	
	<a class="prev-post" href="https:&#x2F;&#x2F;mabez.dev&#x2F;blog&#x2F;posts&#x2F;esp-rust-ecosystem&#x2F;">
	  <span class="post-nav-label">Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><br>
	  <span>Rust on the ESP32 &amp; ESP8266 - Building an ecosystem</span>
	</a>
	
  </div>

  
</main>

	  </div>
	  
	  



<footer id="site-footer" class="section-inner thin animated fadeIn faster">
  <p>&copy; 2021 <a href="https:&#x2F;&#x2F;mabez.dev">Scott Mabin</a> &#183; <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></p>
  <p>Made with <a href="https://www.getzola.org" target="_blank" rel="noopener">Zola</a> &#183; Theme <a href="https://github.com/VersBinarii/hermit_zola" target="_blank" rel="noopener">Hermit_Zola</a>
	
	&#183; <a href="https://mabez.dev/rss.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
	
  </p>
</footer>




	</div>
	
	<script src="https://mabez.dev/js/main.js"></script>

	<!-- Math rendering -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
        onload="renderMathInElement(document.body, { delimiters: [ {left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}, {left: '\\[', right: '\\]', display: true}, {left: '\\(', right: '\\)', display: false}]});"></script>

    

	
	<script src="https://mabez.dev/js/copy.js"></script>
	
	<script src="https://mabez.dev/js/main.js"></script>

    
    

	
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-146726046-1"></script>
    <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());
     gtag('config', 'UA-146726046-1');
    </script>
    
  </body>
</html>
